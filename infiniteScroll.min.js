"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,o=void 0;try{for(var s,_=e[Symbol.iterator]();!(n=(s=_.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{n||null==_.return||_.return()}finally{if(i)throw o}}return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var InfiniteScroll=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{url:null,params:null},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{scrollThreshold:0,appendTo:null,lastHtml:null,errorHtml:null,loader:null,loadingHtml:null,autoTrigger:!0,cache:!1,intervalCheck:!1,intervalTime:40,nextSelector:null,autoTriggerUntil:null,requestType:"get"};_classCallCheck(this,e);this.__settings=Object.assign({scrollThreshold:0,appendTo:null,lastHtml:null,errorHtml:null,loader:null,loadingHtml:null,autoTrigger:!0,cache:!1,intervalCheck:!1,intervalTime:40,nextSelector:null,autoTriggerUntil:null,requestType:"get"},i),this.__contructorValuesCheck(t,n,this.__settings),this.__$container=this.__initSelector(t),this.__$appendTo=this.__settings.appendTo?this.__$container.find(this.__settings.appendTo):this.__$container,this.__urlConfig=n,this.__urlType=this.__checkUrlType(this.__urlConfig.url)?"absolute":"relative",this.__isWindow="visible"===this.__$container.css("overflow-y"),this.__reachedStatus=!1,this.__loading=!1,this.__done=!1,this.__errors=[],this.__counter=0,this.__callbacks={init:function(){},reached:function(){},response:function(){},error:function(){},last:function(){}},this.__$window=$(window),this.__$scroll=this.__isWindow?this.__$window:this.__$container,this.__$body=$("body"),this.__cache=[],this.__settings.cache&&(this.clearCache=function(){r.__cache=[]},this.getFromCache=function(e){if(e>=r.__cache.length||e<0||!Number.isInteger(e))throw new Error("InfiniteScroll method getFromCache error: invalid index");var t=r.__cache[e];return r.__cache.splice(1,e),t},this.saveInCache=function(e){r.__cache.push(e)},this.makeAjax=function(e){r.__done||(r.__loading=!0,r.__ajaxRequest(e))},this.append=function(e){r.__$appendTo.append(e),r.__reachedStatus=!1})}return _createClass(e,[{key:"init",value:function(){this.__settings.intervalCheck?this.__intervalCheckScrollPosition():this.__bindEventListeners(),this.__callbacks.init(this.urlConfig)}},{key:"__contructorValuesCheck",value:function(e,t,r){if(!window.jQuery)throw new Error("InfiniteScroll constructor error: jQuery is not loaded");if(!e)throw new Error("InfiniteScroll constructor error: container is not specified");if(!t)throw new Error("InfiniteScroll constructor error: urlConfig is not specified");if(!t.url)throw new Error("InfiniteScroll constructor error: urlConfig.url is not specified");if(!Number.isInteger(r.scrollThreshold))throw new Error("InfiniteScroll constructor error: scrollThreshold must be a integer");if(!r.autoTrigger&&!r.nextSelector)throw new Error("InfiniteScroll constructor error: AutoTrigger set to false, but nextSelector is not defined");if(r.intervalCheck&&!Number.isInteger(r.intervalTime))throw new Error("InfiniteScroll constructor error: intervalTime must be a integer");if(r.intervalCheck&&r.intervalTime<0)throw new Error("InfiniteScroll constructor error: intervalTime can't be less than 0");if(null!==r.autoTriggerUntil&&!Number.isInteger(r.autoTriggerUntil))throw new Error("InfiniteScroll constructor error: autoTriggerUntil must be a integer");if(null!==r.autoTriggerUntil&&r.autoTriggerUntil<0)throw new Error("InfiniteScroll constructor error: autoTriggerUntil can't be less than 0")}},{key:"__initSelector",value:function(e){return"string"==typeof e?jQuery(e):e}},{key:"__showLoader",value:function(){this.__settings.loader&&(this.loader||(this.loader=this.__initSelector(this.__settings.loader)),this.loader.show()),this.__settings.loadingHtml&&this.__$appendTo.append('<span class="infinite-scroll-loader-handler" style="visibility: hidden;"></span>'+this.__settings.loadingHtml)}},{key:"__hideLoader",value:function(){if(this.__settings.loader&&(this.loader||(this.loader=this.__initSelector(this.__settings.loader)),this.loader.hide()),this.__settings.loadingHtml){var e=this.__$appendTo.find("span.infinite-scroll-loader-handler");e.next().remove(),e.remove()}}},{key:"__checkUrlType",value:function(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)}},{key:"__getSafeParams",value:function(e,t){var r=null;if("absolute"===this.__urlType?r=new URL(e):"relative"===this.__urlType&&(r=new URL(e,document.location.protocol+"//"+document.location.host+"/")),"object"===_typeof(t))for(var n=0,i=Object.entries(t);n<i.length;n++){var o=_slicedToArray(i[n],2),s=o[0],_=o[1];r.searchParams.set(s,_)}return r.toString()}},{key:"__clone",value:function(e){if(null===e||"object"!==_typeof(e)||"isActiveClone"in e)return e;if(_instanceof(e,Date))var t=new e.constructor;else t=e.constructor();for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(e.isActiveClone=null,t[r]=this.__clone(e[r]),delete e.isActiveClone);return t}},{key:"__ajaxRequest",value:function(e){var t=this,r=this.__clone(e);this.__showLoader(),"get"===this.__settings.requestType.toLowerCase()?$.ajax({url:e.params?this.__getSafeParams(e.url,e.params):e.url,type:"GET",success:function(e,n){t.__successResponse(e,r,n)},error:function(e){t.__errorResponse(e)}}):"post"===this.__settings.requestType.toLowerCase()&&$.ajax({url:e.url,type:"POST",data:e.params,success:function(e,n){t.__successResponse(e,r,n)},error:function(e){t.__errorResponse(e)}})}},{key:"__successResponse",value:function(e,t,r){this.__counter++,this.__loading=!1,this.__hideLoader(),this.__responseHandler(e,t)}},{key:"__errorResponse",value:function(e){var t=this;this.__loading=!1,this.__done=!0,this.__errors.push({status:e.status,responseText:e.responseText}),this.__hideLoader(),this.__renderErrorHtmlTemplate();this.__callbacks.error(e,function(){t.__done=!1,t.__loading=!0,t.__ajaxRequest(t.__urlConfig)},this.urlConfig,this.__getInfo())}},{key:"__jsonObjectHandler",value:function(e){try{return JSON.parse(e)}catch(t){return e}}},{key:"__renderLastHtmlTemplate",value:function(){this.__settings.lastHtml&&this.__$appendTo.append(this.__settings.lastHtml)}},{key:"__renderErrorHtmlTemplate",value:function(){this.__settings.errorHtml&&this.__$appendTo.append(this.__settings.errorHtml)}},{key:"__getInfo",value:function(){var e={counter:this.__counter,loading:this.__loading,done:this.__done,errors:this.__errors,isWindow:this.__isWindow,urlType:this.__urlType,scrollFromTop:this.__$window.scrollTop(),settings:{requestType:this.__settings.requestType,scrollThreshold:this.__settings.scrollThreshold,autoTrigger:this.__settings.autoTrigger,autoTriggerUntil:this.__settings.autoTriggerUntil}};return this.__settings.cache&&(e.cache=this.__settings.cache,e.cachedAmount=this.__cache.length,e.reached=this.__reached()||this.__reachedStatus),this.__settings.intervalCheck&&(e.intervalCheck=this.__settings.intervalCheck,e.intervalTime=this.__settings.intervalTime),e}},{key:"__responseHandler",value:function(e,t){var r=this,n=this.__jsonObjectHandler(e);if(n){var i=function(e){r.__$appendTo.append(e),r.__reachedStatus=!1};this.__settings.cache?this.__callbacks.response(n,i,t,this.__getInfo()):this.__callbacks.response(n,i,this.urlConfig,this.__getInfo())}else(!n||"object"===_typeof(n)&&n.hasOwnProperty("done")&&n.done)&&(this.__done=!0,this.__renderLastHtmlTemplate(),this.__callbacks.last(this.__getInfo()))}},{key:"__autoTriggerUntilHanddler",value:function(){return!this.__settings.autoTriggerUntil||this.__settings.autoTriggerUntil>this.__counter}},{key:"on",value:function(e,t){this.__callbacks[e]=t}},{key:"__reached",value:function(){return this.__$window.height()-(this.__$container.offset().top-this.__$window.scrollTop())-this.__$container.height()+this.__settings.scrollThreshold+1>0}},{key:"__intervalCheckScrollPosition",value:function(){var e=this;this.__settings.autoTrigger&&setInterval(function(){e.__reached()&&(e.__loading||e.__done||!e.__autoTriggerUntilHanddler()||(e.__reachedStatus=!0,e.__settings.cache?e.__callbacks.reached(e.urlConfig,e.__getInfo()):(e.__loading=!0,e.__ajaxRequest(e.__urlConfig))))},this.__settings.intervalTime)}},{key:"__bindEventListeners",value:function(){var e=this;this.__settings.autoTrigger&&this.__$window.on("scroll touchmove",function(){e.__reached()&&(e.__loading||e.__done||!e.__autoTriggerUntilHanddler()||(e.__reachedStatus=!0,e.__settings.cache?e.__callbacks.reached(e.urlConfig,e.__getInfo()):(e.__loading=!0,e.__ajaxRequest(e.__urlConfig))))}),this.__settings.nextSelector&&this.__$container.on("click touch",this.__settings.nextSelector,function(){e.__loading||e.__done||!e.__autoTriggerUntilHanddler()||(e.__settings.cache?e.__callbacks.reached(e.urlConfig,e.__getInfo()):(e.__loading=!0,e.__ajaxRequest(e.__urlConfig)))})}},{key:"urlConfig",get:function(){return this.__urlConfig},set:function(e){this.__urlConfig=e}}]),e}();
