class InfiniteScroll{constructor(t,e={url:null,params:null},s={scrollThreshold:0,appendTo:null,lastHtml:null,errorHtml:null,loader:null,loadingHtml:null,autoTrigger:!0,nextSelector:null,autoTriggerUntil:null,requestType:"get"}){this.__settings=Object.assign({scrollThreshold:0,appendTo:null,lastHtml:null,errorHtml:null,loader:null,loadingHtml:null,autoTrigger:!0,nextSelector:null,autoTriggerUntil:null,requestType:"get"},s),this.__contructorValuesCheck(t,e,this.__settings),this.__$container=this.__initSelector(t),this.__$appendTo=this.__settings.appendTo?this.__$container.find(this.__settings.appendTo):this.__$container,this.__urlConfig=e,this.__isWindow="visible"===this.__$container.css("overflow-y"),this.__loading=!1,this.__done=!1,this.__errors=[],this.__counter=0,this.__callbacks={init:()=>{},response:()=>{},error:()=>{},last:()=>{}},this.__$window=$(window),this.__$scroll=this.__isWindow?this.__$window:this.__$container,this.__$body=$("body")}get urlConfig(){return this.__urlConfig}set urlConfig(t){this.__urlConfig=t}init(){this.__bindEventListeners(),this.__callbacks.init()}__contructorValuesCheck(t,e,s){if(!window.jQuery)throw new Error("Constructor error: jQuery is not loaded");if(!t)throw new Error("Constructor error: container is not specified");if(!e)throw new Error("Constructor error: urlConfig is not specified");if(!e.url)throw new Error("Constructor error: urlConfig.url is not specified");if(!Number.isInteger(s.scrollThreshold))throw new Error("Constructor error: scrollThreshold must be a integer");if(!s.autoTrigger&&!s.nextSelector)throw new Error("Constructor error: AutoTrigger set to false, but nextSelector is not defined");if(null!==s.autoTriggerUntil&&!Number.isInteger(s.autoTriggerUntil))throw new Error("Constructor error: autoTriggerUntil must be a integer");if(null!==s.autoTriggerUntil&&s.autoTriggerUntil<0)throw new Error("Constructor error: autoTriggerUntil can't be less than 0")}__initSelector(t){return"string"==typeof t?jQuery(t):t}__showLoader(){this.__settings.loader&&(this.loader||(this.loader=this.__initSelector(this.__settings.loader)),this.loader.show()),this.__settings.loadingHtml&&this.__$appendTo.append('<span class="infinite-scroll-loader-handler" style="visibility: hidden;"></span>'+this.__settings.loadingHtml)}__hideLoader(){if(this.__settings.loader&&(this.loader||(this.loader=this.__initSelector(this.__settings.loader)),this.loader.hide()),this.__settings.loadingHtml){const t=this.__$appendTo.find("span.infinite-scroll-loader-handler");t.next().remove(),t.remove()}}__checkUrlType(t){return new RegExp("^(?:[a-z]+:)?//","i").test(t)}__getSafeParams(t,e){let s=null;const r=this.__checkUrlType(this.urlConfig.url)?"absolute":"relative";if("absolute"===r?s=new URL(t):"relative"===r&&(s=new URL(t,document.location.protocol+"//"+document.location.host+"/")),"object"==typeof e)for(const[t,r]of Object.entries(e))s.searchParams.set(t,r);return s.toString()}__ajaxRequest(){this.__showLoader(),"get"===this.__settings.requestType.toLowerCase()?$.ajax({url:this.urlConfig.params?this.__getSafeParams(this.urlConfig.url,this.urlConfig.params):this.urlConfig.url,type:"GET",success:(t,e)=>{this.__successResponse(t,e)},error:t=>{this.__errorResponse(t)}}):"post"===this.__settings.requestType.toLowerCase()&&$.ajax({url:this.urlConfig.url,type:"POST",data:this.urlConfig.params,success:(t,e)=>{this.__successResponse(t,e)},error:t=>{this.__errorResponse(t)}})}__successResponse(t){this.__counter++,this.__loading=!1,this.__hideLoader(),this.__responseHandler(t)}__errorResponse(t){this.__loading=!1,this.__done=!0,this.__errors.push({status:t.status,responseText:t.responseText}),this.__hideLoader(),this.__renderErrorHtmlTemplate();this.__callbacks.error(t,()=>{this.__done=!1,this.__loading=!0,this.__ajaxRequest()},this.urlConfig,this.__getInfo())}__jsonObjectHandler(t){try{return JSON.parse(t)}catch(e){return t}}__renderLastHtmlTemplate(){this.__settings.lastHtml&&this.__$appendTo.append(this.__settings.lastHtml)}__renderErrorHtmlTemplate(){this.__settings.errorHtml&&this.__$appendTo.append(this.__settings.errorHtml)}__getInfo(){return{counter:this.__counter,loading:this.__loading,done:this.__done,errors:this.__errors,isWindow:this.__isWindow,settings:{requestType:this.__settings.requestType,scrollThreshold:this.__settings.scrollThreshold,autoTrigger:this.__settings.autoTrigger,autoTriggerUntil:this.__settings.autoTriggerUntil}}}__responseHandler(t){const e=this.__jsonObjectHandler(t);if(e){const t=t=>{this.__$appendTo.append(t)};this.__callbacks.response(e,t,this.urlConfig,this.__getInfo())}else(!e||"object"==typeof e&&e.hasOwnProperty("done")&&e.done)&&(this.__done=!0,this.__renderLastHtmlTemplate(),this.__callbacks.last(this.__getInfo()))}__autoTriggerUntilHanddler(){return!this.__settings.autoTriggerUntil||this.__settings.autoTriggerUntil>this.__counter}on(t,e){this.__callbacks[t]=e}__bindEventListeners(){this.__settings.autoTrigger&&this.__$window.on("scroll",()=>{this.__$window.height()-(this.__$container.offset().top-this.__$window.scrollTop())-this.__$container.height()-this.__$container.scrollTop()+this.__settings.scrollThreshold+1>0&&(this.__loading||this.__done||!this.__autoTriggerUntilHanddler()||(this.__loading=!0,this.__ajaxRequest()))}),this.__settings.nextSelector&&this.__$container.on("click touch",this.__settings.nextSelector,()=>{this.__loading||this.__done||!this.__autoTriggerUntilHanddler()||(this.__loading=!0,this.__ajaxRequest())})}}
