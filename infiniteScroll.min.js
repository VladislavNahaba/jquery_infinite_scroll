"use strict";function _instanceof(t,e){return null!=e&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?!!e[Symbol.hasInstance](t):t instanceof e}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,o=!1,i=void 0;try{for(var s,l=t[Symbol.iterator]();!(n=(s=l.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{n||null==l.return||l.return()}finally{if(o)throw i}}return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!_instanceof(t,e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}var InfiniteScroll=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{url:null,params:null},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{scrollThreshold:0,appendTo:null,lastHtml:null,errorHtml:null,loader:null,loadingHtml:null,autoTrigger:!0,nextSelector:null,autoTriggerUntil:null,requestType:"get"};_classCallCheck(this,t);this.__settings=Object.assign({scrollThreshold:0,appendTo:null,lastHtml:null,errorHtml:null,loader:null,loadingHtml:null,autoTrigger:!0,nextSelector:null,autoTriggerUntil:null,requestType:"get"},n),this.__contructorValuesCheck(e,r,this.__settings),this.__$container=this.__initSelector(e),this.__$appendTo=this.__settings.appendTo?this.__$container.find(this.__settings.appendTo):this.__$container,this.__urlConfig=r,this.__isWindow="visible"===this.__$container.css("overflow-y"),this.__loading=!1,this.__done=!1,this.__errors=[],this.__counter=0,this.__callbacks={init:function(){},response:function(){},error:function(){},last:function(){}},this.__$window=$(window),this.__$scroll=this.__isWindow?this.__$window:this.__$container,this.__$body=$("body")}return _createClass(t,[{key:"init",value:function(){this.__bindEventListeners(),this.__callbacks.init()}},{key:"__contructorValuesCheck",value:function(t,e,r){if(!window.jQuery)throw new Error("Constructor error: jQuery is not loaded");if(!t)throw new Error("Constructor error: container is not specified");if(!e)throw new Error("Constructor error: urlConfig is not specified");if(!e.url)throw new Error("Constructor error: urlConfig.url is not specified");if(!Number.isInteger(r.scrollThreshold))throw new Error("Constructor error: scrollThreshold must be a integer");if(!r.autoTrigger&&!r.nextSelector)throw new Error("Constructor error: AutoTrigger set to false, but nextSelector is not defined");if(null!==r.autoTriggerUntil&&!Number.isInteger(r.autoTriggerUntil))throw new Error("Constructor error: autoTriggerUntil must be a integer");if(null!==r.autoTriggerUntil&&r.autoTriggerUntil<0)throw new Error("Constructor error: autoTriggerUntil can't be less than 0")}},{key:"__initSelector",value:function(t){return"string"==typeof t?jQuery(t):t}},{key:"__showLoader",value:function(){this.__settings.loader&&(this.loader||(this.loader=this.__initSelector(this.__settings.loader)),this.loader.show()),this.__settings.loadingHtml&&this.__$appendTo.append('<span class="infinite-scroll-loader-handler" style="visibility: hidden;"></span>'+this.__settings.loadingHtml)}},{key:"__hideLoader",value:function(){if(this.__settings.loader&&(this.loader||(this.loader=this.__initSelector(this.__settings.loader)),this.loader.hide()),this.__settings.loadingHtml){var t=this.__$appendTo.find("span.infinite-scroll-loader-handler");t.next().remove(),t.remove()}}},{key:"__checkUrlType",value:function(t){return new RegExp("^(?:[a-z]+:)?//","i").test(t)}},{key:"__getSafeParams",value:function(t,e){var r=null,n=this.__checkUrlType(this.urlConfig.url)?"absolute":"relative";if("absolute"===n?r=new URL(t):"relative"===n&&(r=new URL(t,document.location.protocol+"//"+document.location.host+"/")),"object"===_typeof(e))for(var o=0,i=Object.entries(e);o<i.length;o++){var s=_slicedToArray(i[o],2),l=s[0],a=s[1];r.searchParams.set(l,a)}return r.toString()}},{key:"__ajaxRequest",value:function(){var t=this;this.__showLoader(),"get"===this.__settings.requestType.toLowerCase()?$.ajax({url:this.urlConfig.params?this.__getSafeParams(this.urlConfig.url,this.urlConfig.params):this.urlConfig.url,type:"GET",success:function(e,r){t.__successResponse(e,r)},error:function(e){t.__errorResponse(e)}}):"post"===this.__settings.requestType.toLowerCase()&&$.ajax({url:this.urlConfig.url,type:"POST",data:this.urlConfig.params,success:function(e,r){t.__successResponse(e,r)},error:function(e){t.__errorResponse(e)}})}},{key:"__successResponse",value:function(t){this.__counter++,this.__loading=!1,this.__hideLoader(),this.__responseHandler(t)}},{key:"__errorResponse",value:function(t){var e=this;this.__loading=!1,this.__done=!0,this.__errors.push({status:t.status,responseText:t.responseText}),this.__hideLoader(),this.__renderErrorHtmlTemplate();this.__callbacks.error(t,function(){e.__done=!1,e.__loading=!0,e.__ajaxRequest()},this.urlConfig,this.__getInfo())}},{key:"__jsonObjectHandler",value:function(t){try{return JSON.parse(t)}catch(e){return t}}},{key:"__renderLastHtmlTemplate",value:function(){this.__settings.lastHtml&&this.__$appendTo.append(this.__settings.lastHtml)}},{key:"__renderErrorHtmlTemplate",value:function(){this.__settings.errorHtml&&this.__$appendTo.append(this.__settings.errorHtml)}},{key:"__getInfo",value:function(){return{counter:this.__counter,loading:this.__loading,done:this.__done,errors:this.__errors,isWindow:this.__isWindow,settings:{requestType:this.__settings.requestType,scrollThreshold:this.__settings.scrollThreshold,autoTrigger:this.__settings.autoTrigger,autoTriggerUntil:this.__settings.autoTriggerUntil}}}},{key:"__responseHandler",value:function(t){var e=this,r=this.__jsonObjectHandler(t);if(r){this.__callbacks.response(r,function(t){e.__$appendTo.append(t)},this.urlConfig,this.__getInfo())}else(!r||"object"===_typeof(r)&&r.hasOwnProperty("done")&&r.done)&&(this.__done=!0,this.__renderLastHtmlTemplate(),this.__callbacks.last(this.__getInfo()))}},{key:"__autoTriggerUntilHanddler",value:function(){return!this.__settings.autoTriggerUntil||this.__settings.autoTriggerUntil>this.__counter}},{key:"on",value:function(t,e){this.__callbacks[t]=e}},{key:"__bindEventListeners",value:function(){var t=this;this.__settings.autoTrigger&&this.__$window.on("scroll",function(){t.__$window.height()-(t.__$container.offset().top-t.__$window.scrollTop())-t.__$container.height()-t.__$container.scrollTop()+t.__settings.scrollThreshold+1>0&&(t.__loading||t.__done||!t.__autoTriggerUntilHanddler()||(t.__loading=!0,t.__ajaxRequest()))}),this.__settings.nextSelector&&this.__$container.on("click touch",this.__settings.nextSelector,function(){t.__loading||t.__done||!t.__autoTriggerUntilHanddler()||(t.__loading=!0,t.__ajaxRequest())})}},{key:"urlConfig",get:function(){return this.__urlConfig},set:function(t){this.__urlConfig=t}}]),t}();
